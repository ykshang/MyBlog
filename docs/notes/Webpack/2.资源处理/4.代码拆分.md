---
title: 代码拆分
createTime: 2025/03/15 14:24:21
permalink: /Webpack/dwuygr9t/
---

Webpack 的 **代码拆分（Code Splitting）** 是一种将代码分割成多个 bundle 或 chunk 的技术，目的是减少初始加载时间，优化应用性能。

Webpack 打包代码时会根据 chunk 来将所有 js 文件打包到一个文件中，这样打包出来的文件可能体积很大。我们如果只要渲染首页，就应该只加载首页的 js 文件，其他文件不应该加载。所以我们需要将打包生成的文件进行代码分割，生成多个 js 文件，渲染哪个页面就只加载某个 js 文件，这样加载的资源就少，速度就更快。

因此我们需要基于一定策略和维度来分割代码。以下是 Webpack 代码拆分的核心概念和实现方式：

::: tip 总结

- 在 webpack 配置文件中启用并**配置代码分割**策略，设置合适的参数
- 可以使用**魔法注释**告诉 webpack 输出文件的名字，有助于我们进行打包分析。
- **Css 文件提取：** 使用`MiniCssExtractPlugin `将 css 从 html 里提取出来
- **提取公共依赖** splitChunks 去指定模块或者路径
- **提取重复代码** splitChunks 定义被复用次数

:::

## 核心思想

- **将代码拆分成多个文件**：将应用代码分割成多个 bundle 或 chunk，而不是打包成一个巨大的文件。
- **按需加载**：只在需要时加载特定的代码块，减少初始加载时间。
- **提高缓存利用率**：通过拆分，尽量减小代码的影响范围，利用浏览器缓存提升性能。

## 拆分策略

- 公共代码：主要指 `common`、`util`、`layout`。
- Runtime 文件：和公共代码类似，runtime 代码是 webpack 用来处理模块依赖的辅助代码、胶水代码。
- 第三方依赖（Vendor）：其实就是把 `node_module` 拆分成多个 Vendor，把诸如 Element-UI、Vue、Loadash 等体积较大的包拆分出来单独打包。
- 魔法注释：Webpack 提供魔法注释 `/* webpackChunkName: "name" */`，我们可以用来标记 `import()` 引入的模块，这样可以给代码拆分后的文件起一个自定义的名称，一般用来标记路由组件、公共组件、第三方库等。

### 1、配置多入口

合理拆分代码，将代码拆分为多页面应用，通过配置多个入口文件，自动拆分代码。

```javascript
module.exports = {
  entry: {
    app: "./src/app.js",
    vendor: "./src/vendor.js",
  },
  output: {
    filename: "[name].bundle.js", // name 为对应
    path: __dirname + "/dist",
  },
};
```

- **缺点**：如果多个入口文件依赖相同的模块，会导致重复打包。

## 优势

- **减少初始加载时间**：只加载必要的代码，提升页面加载速度。
- **优化缓存**：将第三方库和公共代码单独打包，利用浏览器缓存。
- **提升用户体验**：按需加载资源，避免页面卡顿。

## 4、注意事项

- **避免过度拆分**：过多的 chunk 文件可能导致 HTTP 请求增加，反而影响性能。
- **合理配置缓存**：确保公共代码和第三方库的 chunk 能够被浏览器缓存。
- **处理加载状态**：动态加载组件时，需提供加载指示（如加载动画）。

## 5、总结

Webpack 的代码拆分通过 **动态导入**、**SplitChunksPlugin** 和 **预加载/预取** 等技术，将代码分割成多个 bundle 或 chunk，优化应用的加载性能。合理使用代码拆分可以显著提升用户体验，特别是在大型单页面应用（SPA）中。
