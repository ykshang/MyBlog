---
title: Snabbdom 经典Vdom库
createTime: 2025/07/07 17:39:00
permalink: /PopularLibrary/fap39teb/
---

## 什么是 Snabbdom？

Snabbdom 是一个轻量级、高性能的虚拟 DOM 库，专注于提供简洁的 API 和极致的渲染性能。它的核心代码仅约 200 行（SLOC），但功能强大，适合构建动态 UI 或需要频繁更新的应用。

## 核心特点

- 极简高效：体积小（核心代码精简），虚拟 DOM Diff 算法优化，性能接近原生 DOM 操作。
- 模块化设计：通过插件扩展功能（如 class、style、eventlisteners 等）。
- 无框架绑定：不强制使用特定架构，可与任何技术栈结合（如原生 JS、TypeScript）。
- 函数式风格：视图通过纯函数声明，数据驱动更新。

## 核心 API

### `h(tag, data, children)`：创建虚拟节点（VNode）

```javascript
h("div", { class: { active: true } }, "Hello Snabbdom");
```

### `init(modules)`：初始化 Snabbdom，返回 patch 函数

```javascript
const patch = init([classModule, styleModule]);
```

### `patch(oldVNode, newVNode)`：对比并更新 DOM

```javascript
patch(document.getElementById("app"), h("div", "Initial Render"));
```

## 使用示例

### 项目安装

我们可以使用 webpack 环境来演示：

```bash
## 项目目录
mkdir snabbdom-demo && cd snabbdom-demo
## 初始化依赖
pnpm init -y
## 安装依赖包
pnpm add snabbdom webpack webpack-cli webpack-dev-server html-webpack-plugin
```

### 项目结构

:::file-tree

- node_modules/
- src
  - index.js
- webpack.config.js
- package.json
- index.html
- pnpm-lock.yaml
- package-lock.json

:::

### 关键代码

::::code-tabs
@tab webpack.config.js

```js :collapsed-lines=10
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  mode: "development",
  entry: "./src/index.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "bundle.js",
    clean: true,
  },
  devServer: {
    static: {
      directory: path.join(__dirname, "dist"),
    },
    compress: true,
    liveReload: true,
    port: 9000,
    hot: true,
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./index.html",
    }),
  ],
};
```

@tab index.js

```js :collapsed-lines=10
import {
  init,
  classModule,
  propsModule,
  styleModule,
  eventListenersModule,
  h,
} from "snabbdom";

// 通过传入模块初始化 patch 函数
const patch = init([
  classModule, // 开启 classes 功能
  propsModule, // 支持传入 props
  styleModule, // 支持内联样式同时支持动画
  eventListenersModule, // 添加事件监听
]);

const container = document.getElementById("container"); // [!code highlight]

const vnode = h("div#container.two.classes", { on: { click: someFn } }, [
  h("span", { style: { fontWeight: "bold" } }, "This is bold"),
  " and this is just normal text",
  h("a", { props: { href: "/foo" } }, "I'll take you places!"),
]);
// 传入一个空的元素节点 - 将产生副作用（修改该节点）
patch(container, vnode);

const newVnode = h(
  "div#container.two.classes",
  { on: { click: anotherEventHandler } },
  [
    h(
      "span",
      { style: { fontWeight: "normal", fontStyle: "italic" } },
      "This is now italic type"
    ),
    " and this is still just normal text",
    h("a", { props: { href: "/bar" } }, "I'll take you places!"),
  ]
);
// 再次调用 `patch`
patch(vnode, newVnode); // 将旧节点更新为新节点

function someFn() {
  console.clear();
  console.log("someFn");
  console.log(...arguments);
}
function anotherEventHandler() {
  console.clear();
  console.log("anotherEventHandler");
  console.log(...arguments);
}
```

@tab index.html

```html :collapsed-lines=10
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Snabbdom Demo</title>
  </head>
  <body>
    <div id="container"></div>
    // [!code highlight]
  </body>
</html>
```

@tab package.json

```json :collapsed-lines=10
{
  "name": "snabbdom",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "dev": "webpack-dev-server" // [!code highlight]
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "packageManager": "pnpm@10.12.4",
  "dependencies": {
    "html-webpack-plugin": "^5.6.3",
    "snabbdom": "^3.6.2",
    "webpack": "^5.99.9",
    "webpack-cli": "^6.0.1",
    "webpack-dev-server": "^5.2.2"
  }
}
```

::::

### 启动项目
