---
title: CSS 模块化
createTime: 2026/01/06 22:27:18
permalink: /notes/CSS/p8cg6hkv/
---

## 1. 引言

### 1.1 CSS 的发展历程

CSS（层叠样式表）自1996年诞生以来，经历了从简单样式描述到复杂系统设计的演变。随着前端应用复杂度的增加，CSS 的可维护性问题日益凸显。

### 1.2 问题的出现

传统 CSS 存在的主要问题：

- **全局命名空间污染**：类名冲突难以避免
- **依赖管理困难**：样式之间的依赖关系不明确
- **代码复用性差**：难以提取和复用公共样式
- **可测试性差**：样式难以进行单元测试

## 2. CSS 模块化的核心理念

### 2.1 什么是 CSS 模块化？

CSS 模块化是一种将样式组织为独立、可复用、可组合模块的开发方法，强调局部作用域和显式依赖。

### 2.2 核心原则

1. **局部作用域**：样式只影响特定组件
2. **显式依赖**：样式依赖关系清晰明确
3. **可组合性**：样式模块可以灵活组合
4. **可复用性**：通用样式可跨项目复用

## 3. 主流 CSS 模块化方案

### 3.1 CSS Modules

#### 3.1.1 基本概念

```css
/* Button.module.css */
.button {
  padding: 12px 24px;
  border-radius: 4px;
}

.primary {
  background-color: #007bff;
  color: white;
}

.danger {
  background-color: #dc3545;
  color: white;
}
```

#### 3.1.2 JavaScript 中使用

```javascript
import styles from './Button.module.css';

function Button({ variant = 'primary' }) {
  return (
    <button className={`${styles.button} ${styles[variant]}`}>
      Click me
    </button>
  );
}
```

#### 3.1.3 编译结果

```css
/* 编译后 */
.Button_button__abc123 {
  padding: 12px 24px;
  border-radius: 4px;
}

.Button_primary__def456 {
  background-color: #007bff;
  color: white;
}
```

### 3.2 CSS-in-JS

#### 3.2.1 Styled-components

```javascript
import styled from 'styled-components';

const Button = styled.button`
  padding: 12px 24px;
  border-radius: 4px;
  background-color: ${props => props.primary ? '#007bff' : '#6c757d'};
  color: white;
  border: none;
  cursor: pointer;
  
  &:hover {
    opacity: 0.9;
  }
  
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
`;

// 使用
<Button primary>主要按钮</Button>
```

#### 3.2.2 Emotion

```javascript
/** @jsxImportSource @emotion/react */
import { css } from '@emotion/react';

const buttonStyles = css`
  padding: 12px 24px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
`;

const primaryStyles = css`
  background-color: #007bff;
  color: white;
`;

function Button({ children, primary }) {
  return (
    <button css={[buttonStyles, primary && primaryStyles]}>
      {children}
    </button>
  );
}
```

### 3.3 Utility-First CSS

#### 3.3.1 Tailwind CSS

```html
<button class="px-6 py-3 rounded-lg bg-blue-600 text-white 
               hover:bg-blue-700 focus:outline-none focus:ring-2 
               focus:ring-blue-500 focus:ring-opacity-50
               transition-colors duration-200">
  按钮
</button>
```

#### 3.3.2 配置示例

```javascript
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        brand: {
          50: '#eff6ff',
          100: '#dbeafe',
          500: '#3b82f6',
          600: '#2563eb',
        }
      }
    }
  }
}
```

### 3.4 BEM 方法论

```css
/* Block Element Modifier */
.button { /* Block */ }
.button__icon { /* Element */ }
.button--disabled { /* Modifier */ }
.button--primary { /* Modifier */ }

/* 使用 */
<button class="button button--primary button--disabled">
  <span class="button__icon">✓</span>
  提交
</button>
```

## 4. Vue 生态系统中的 CSS 模块化

### 4.1 Vue 单文件组件 (SFC)

#### 4.1.1 Scoped CSS

```vue
<template>
  <div class="container">
    <h1 class="title">标题</h1>
  </div>
</template>

<style scoped>
.container {
  padding: 20px;
}

.title {
  color: #333;
  font-size: 24px;
}
</style>
```

#### 4.1.2 CSS Modules

```vue
<script>
import style from './diy.module.css'
</script>
<template>
  <div :class="style.container">
    <h1 :class="style.title">标题</h1>
  </div>
</template>
```

#### 4.1.3 组合 API

```vue
<script setup>
import { useCssModule } from 'vue';

const $style = useCssModule();

const classNames = {
  container: $style.container,
  title: $style.title,
  'is-active': $style.active
};
</script>
<style module>
.container {
  padding: 20px;
}

.title {
  color: #333;
  font-size: 24px;
}
</style>
<!-- 或者 -->
<!-- <style module src="./diy.module.css" /> -->
```

### 4.2 Vue 3 + Vite 配置

#### 4.2.1 vite.config.js

```javascript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';

export default defineConfig({
  plugins: [vue()],
  css: {
    modules: {
      // 类名生成规则
      generateScopedName: '[name]__[local]___[hash:base64:5]',
      // 启用驼峰转换
      localsConvention: 'camelCase',
      // 全局模式
      scopeBehaviour: 'local',
      // 哈希前缀
      hashPrefix: 'prefix',
      // 自定义生成函数
      generateScopedName: (name, filename, css) => {
        const componentName = filename.split('/').pop().split('.')[0];
        const hash = require('node:crypto')
          .createHash('sha256')
          .update(css)
          .digest('hex')
          .substr(0, 8);
        return `${componentName}_${name}_${hash}`;
      }
    },
    preprocessorOptions: {
      scss: {
        additionalData: `@import "@/styles/variables.scss";`
      }
    }
  }
});
```

## 5. 现代 CSS 模块化最佳实践

### 5.1 项目结构组织

```
src/
├── styles/
│   ├── base/
│   │   ├── reset.css
│   │   ├── typography.css
│   │   └── variables.css
│   ├── components/
│   │   ├── Button.module.css
│   │   ├── Input.module.css
│   │   └── Modal.module.css
│   ├── layouts/
│   │   ├── Header.module.css
│   │   ├── Footer.module.css
│   │   └── Sidebar.module.css
│   ├── utils/
│   │   ├── animations.css
│   │   ├── mixins.css
│   │   └── utilities.css
│   └── themes/
│       ├── light.css
│       └── dark.css
├── components/
│   ├── Button/
│   │   ├── Button.vue
│   │   ├── Button.module.css
│   │   └── Button.test.js
│   └── Modal/
└── views/
```

### 5.2 设计系统集成

#### 5.2.1 设计令牌 (Design Tokens)

```css
/* design-tokens.css */
:root {
  /* 颜色系统 */
  --color-primary-50: #eff6ff;
  --color-primary-500: #3b82f6;
  --color-primary-900: #1e3a8a;
  
  /* 间距系统 */
  --spacing-1: 4px;
  --spacing-2: 8px;
  --spacing-4: 16px;
  
  /* 字体系统 */
  --font-family-sans: 'Inter', system-ui, sans-serif;
  --font-size-sm: 14px;
  --font-size-lg: 18px;
  
  /* 边框系统 */
  --border-radius-sm: 4px;
  --border-radius-lg: 8px;
}
```

#### 5.2.2 组件样式架构

```css
/* Button.module.css */
.button {
  /* 基础样式 */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-family-sans);
  font-weight: 500;
  border: 1px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
  
  /* 尺寸变量 */
  --button-padding-x: var(--spacing-4);
  --button-padding-y: var(--spacing-2);
  --button-font-size: var(--font-size-sm);
  
  padding: var(--button-padding-y) var(--button-padding-x);
  font-size: var(--button-font-size);
}

/* 变体 */
.primary {
  background-color: var(--color-primary-500);
  color: white;
}

.primary:hover {
  background-color: var(--color-primary-600);
}

/* 尺寸 */
.small {
  --button-padding-x: var(--spacing-3);
  --button-padding-y: var(--spacing-1);
  --button-font-size: var(--font-size-xs);
}

.large {
  --button-padding-x: var(--spacing-6);
  --button-padding-y: var(--spacing-3);
  --button-font-size: var(--font-size-lg);
}
```

### 5.3 性能优化策略

#### 5.3.1 代码分割

```javascript
// 动态导入 CSS 模块
const loadStyles = async () => {
  if (route.name === 'Dashboard') {
    const dashboardStyles = await import('./Dashboard.module.css');
    // 使用样式
  }
};
```

#### 5.3.2 关键 CSS 提取

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import { createHtmlPlugin } from 'vite-plugin-html';

export default defineConfig({
  plugins: [
    createHtmlPlugin({
      minify: true,
      inject: {
        data: {
          criticalCSS: extractCriticalCSS()
        }
      }
    })
  ]
});
```

#### 5.3.3 缓存策略

```nginx
# Nginx 配置
location ~* \.css$ {
  expires 1y;
  add_header Cache-Control "public, immutable";
}
```

### 5.4 测试策略

#### 5.4.1 视觉回归测试

```javascript
// visual-test.js
import { mount } from '@vue/test-utils';
import Button from './Button.vue';
import { toMatchImageSnapshot } from 'jest-image-snapshot';

expect.extend({ toMatchImageSnapshot });

test('Button renders correctly', async () => {
  const wrapper = mount(Button, {
    props: { variant: 'primary' },
    slots: { default: 'Click me' }
  });
  
  const image = await wrapper.getScreenshot();
  expect(image).toMatchImageSnapshot();
});
```

#### 5.4.2 样式单元测试

```javascript
// style-test.js
import styles from './Button.module.css';

describe('Button styles', () => {
  test('contains required classes', () => {
    expect(styles.button).toBeDefined();
    expect(styles.primary).toBeDefined();
    expect(styles.small).toBeDefined();
  });
  
  test('class names are properly hashed', () => {
    expect(styles.button).toMatch(/button__\w+___\w+/);
  });
});
```

## 6. 构建工具集成

### 6.1 Webpack 配置

```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.module\.css$/,
        use: [
          'style-loader',
          {
            loader: 'css-loader',
            options: {
              modules: {
                mode: 'local',
                localIdentName: '[path][name]__[local]--[hash:base64:5]',
                exportLocalsConvention: 'camelCase',
              },
              importLoaders: 1,
            },
          },
          'postcss-loader',
        ],
      },
    ],
  },
};
```

### 6.2 PostCSS 插件链

```javascript
// postcss.config.js
module.exports = {
  plugins: [
    require('postcss-import'),
    require('postcss-mixins'),
    require('postcss-nested'),
    require('postcss-preset-env')({
      stage: 3,
      features: {
        'custom-properties': { preserve: false },
        'nesting-rules': true,
      },
    }),
    require('cssnano')({
      preset: 'default',
    }),
  ],
};
```

## 7. 未来趋势与演进

### 7.1 CSS 原生模块化

```css
/* 提案中的 CSS 模块化语法 */
@import "./components/Button.css" layer(components);

@layer components {
  .button {
    /* 组件样式 */
  }
}

/* 作用域样式 */
@scope (.card) to (.content) {
  p {
    color: red;
  }
}
```

### 7.2 容器查询

```css
/* 基于容器的响应式设计 */
.component {
  container-type: inline-size;
}

@container (min-width: 400px) {
  .element {
    display: flex;
  }
}
```

### 7.3 CSS Houdini

```javascript
// 自定义 CSS 属性
CSS.registerProperty({
  name: '--gradient-angle',
  syntax: '<angle>',
  initialValue: '0deg',
  inherits: false,
});
```

## 8. 总结与建议

### 8.1 选择策略

| 方案 | 适用场景 | 优点 | 缺点 |
|------|----------|------|------|
| CSS Modules | 企业级应用、团队协作 | 作用域隔离、类型安全 | 配置复杂、学习曲线 |
| CSS-in-JS | 组件库、动态样式 | 高度动态、主题切换 | 运行时开销、SSR 复杂 |
| Utility-First | 快速原型、设计系统 | 开发速度快、一致性高 | 类名冗长、语义化差 |
| BEM | 传统项目、迁移成本低 | 语义清晰、兼容性好 | 手动管理、命名冗长 |

### 8.2 推荐实践

1. **新项目**：采用 CSS Modules + 设计令牌 + 原子化工具类
2. **组件库**：使用 CSS-in-JS 实现动态主题和样式覆盖
3. **遗留项目**：渐进式迁移，从 BEM 逐步过渡到模块化
4. **性能敏感**：预编译 CSS Modules，避免运行时开销

### 8.3 持续演进

CSS 模块化是一个不断演进的技术领域。建议团队：

- 定期评估新技术和方案
- 建立样式规范和代码审查机制
- 投资设计系统和工具链建设
- 关注 W3C 标准和浏览器原生支持

---

## 附录：常用工具和资源

### 工具库

- **CSS Modules**: [github.com/css-modules/css-modules](https://github.com/css-modules/css-modules)
- **Styled-components**: [styled-components.com](https://styled-components.com)
- **Emotion**: [emotion.sh](https://emotion.sh)
- **Tailwind CSS**: [tailwindcss.com](https://tailwindcss.com)
- **PostCSS**: [postcss.org](https://postcss.org)

### 学习资源

- **CSS-Tricks**: CSS Modules 指南
- **MDN Web Docs**: CSS 作用域和模块
- **Vue.js 官方文档**: 样式和 CSS Modules
- **React 文档**: CSS-in-JS 和样式方案

### 性能监控

- **CSS Stats**: 分析 CSS 复杂度和性能
- **PurgeCSS**: 删除未使用的 CSS
- **Critical CSS**: 提取关键 CSS
- **Lighthouse**: 全面的性能审计

---

**版本**: 1.0.0  
**最后更新**: 2024年1月  
**作者**: 前端架构团队  
**适用框架**: Vue 3.x, React 18+, 现代前端框架
