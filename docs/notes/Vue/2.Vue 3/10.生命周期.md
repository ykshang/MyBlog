---
title: 生命周期钩子
createTime: 2025/08/08 00:35:21
permalink: /Vue/m8d9flw5/
---

## 概念

Vue 组件实例在创建时要经历一系列的初始化步骤。在此过程中，Vue 会在合适的时机，调用特定的函数，从而让开发者有机会在特定阶段运行自己的代码，这些特定的函数统称为：==生命周期钩子==。

## 介绍

生命周期整体分为四个阶段，分别是：**创建、挂载、更新、销毁**，每个阶段对外暴露了两个钩子，执行前、执行后。

### Vue 2 的生命周期

- 创建阶段：`beforeCreate`、`created`
- 挂载阶段：`beforeMount`、`mounted`
- 更新阶段：`beforeUpdate`、`updated`
- 销毁阶段：`beforeDestroy`、`destroyed`

### Vue3 的生命周期

- 创建阶段：`setup`
- 挂载阶段：`onBeforeMount`、`onMounted`
- 更新阶段：`onBeforeUpdate`、`onUpdated`
- 卸载阶段：`onBeforeUnmount`、`onUnmounted`

常用的钩子：`onMounted`(挂载完毕)、`onUpdated`(更新完毕)、`onBeforeUnmount`(卸载之前)

### 父子组件的先后顺序

#### 创建

**父组件先创建、子组件后创建**

创建的顺序在初始化阶段，将模板转化为 ast，ast 转化为 `h()` 嵌套对象的过程，肯定先创建父节点，然后创建子节点。

#### 挂载和更新

**父组件先挂载、子组件后挂载，子组件先更新、父组件后更新**

挂载和更新的顺序取决于 diff 算法：diff 算法是优先找到相同节点，对其进行深度优先的 diff，最后进行同层比较

- 挂载相当于 diff 算法里的 oVnode 为空、nVnode 不为空。先 `createElm`， 然后把节点插入到 DOM 上。那么肯定是 **先创建父节点**。

  其顺序为：父 `onBeforeMount` > 父 `mounted` > 子 `onBeforeMount` > 子 `mounted` > 子 `onMounted` > 父 `onMounted`

- 更新相当于 diff 算法里的 oVnode 和 nVnode 都不为空。深度优先时，肯定是 ==子组件先更新==。

  其顺序为：父 `onBeforeUpdate` > 子 `onBeforeUpdate` > 子 `update` > 子 `onUpdated` > 父 `update` > 父 `onUpdated`

## 示例代码：

以下是一个 Vue 3 生命周期钩子的示例代码：

```vue
<template>
  <div class="person">
    <h2>当前求和为：{{ sum }}</h2>
    <button @click="changeSum">点我sum+1</button>
  </div>
</template>

<script lang="ts" setup name="Person">
import {
  ref,
  onBeforeMount,
  onMounted,
  onBeforeUpdate,
  onUpdated,
  onBeforeUnmount,
  onUnmounted,
} from "vue";

// 数据
let sum = ref(0);
// 方法
function changeSum() {
  sum.value += 1;
}
console.log("setup");
// 生命周期钩子
onBeforeMount(() => {
  console.log("挂载之前");
});
onMounted(() => {
  console.log("挂载完毕");
});
onBeforeUpdate(() => {
  console.log("更新之前");
});
onUpdated(() => {
  console.log("更新完毕");
});
onBeforeUnmount(() => {
  console.log("卸载之前");
});
onUnmounted(() => {
  console.log("卸载完毕");
});
</script>
```
