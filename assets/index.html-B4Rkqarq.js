import{_ as i,c as a,d as e,o as n}from"./app-BN04xNHl.js";const t={};function h(l,s){return n(),a("div",null,[...s[0]||(s[0]=[e(`<p>在 Vue CLI 创建的 Vue 项目中，Webpack 编译后的 JavaScript 文件的加载行为默认是 <strong><code>defer</code></strong>，而不是 <code>async</code>。这是 Vue CLI 的默认优化策略，主要基于以下原因：</p><hr><h3 id="_1-默认行为-defer" tabindex="-1"><a class="header-anchor" href="#_1-默认行为-defer"><span><strong>1. 默认行为：<code>defer</code></strong></span></a></h3><p>Vue CLI 使用 <code>html-webpack-plugin</code> 生成最终的 <code>index.html</code>，并默认设置：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-javascript"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">new</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> HtmlWebpackPlugin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">({</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  scriptLoading</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">defer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // Vue CLI 默认使用 defer</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以，编译后的 <code>app.js</code> 和 <code>chunk-vendors.js</code> 等脚本会带有 <code>defer</code> 属性：</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-html"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">script</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> defer</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> src</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/js/app.123456.js</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;&lt;/</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">script</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> defer</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> src</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/js/chunk-vendors.789abc.js</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;&lt;/</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2-为什么选择-defer-而不是-async" tabindex="-1"><a class="header-anchor" href="#_2-为什么选择-defer-而不是-async"><span><strong>2. 为什么选择 <code>defer</code> 而不是 <code>async</code>？</strong></span></a></h3><p>Vue CLI 选择 <code>defer</code> 的主要原因是：</p><ol><li><p><strong>保证执行顺序</strong></p><ul><li><code>defer</code> 会按 HTML 中的顺序依次执行（<code>chunk-vendors.js</code> → <code>app.js</code>），确保 Vue 依赖（如 Vue 本身、Vue Router、Vuex）先加载，再执行应用代码。</li><li><code>async</code> 不能保证顺序，可能导致依赖未加载时就执行应用代码，引发错误。</li></ul></li><li><p><strong>优化首屏渲染</strong></p><ul><li><code>defer</code> 脚本在 DOM 解析完成后按顺序执行，不会阻塞渲染。</li><li><code>async</code> 可能在 DOM 解析中途执行，可能阻塞渲染。</li></ul></li><li><p><strong>与 Vue 运行时兼容性</strong><br> Vue 的运行时需要依赖（如 <code>vue.runtime.esm.js</code>）优先加载，<code>defer</code> 更符合这种需求。</p></li></ol><hr><h3 id="_3-动态导入-code-splitting-的-async-行为" tabindex="-1"><a class="header-anchor" href="#_3-动态导入-code-splitting-的-async-行为"><span><strong>3. 动态导入（Code Splitting）的 <code>async</code> 行为</strong></span></a></h3><p>通过 <code>import()</code> 动态加载的组件或路由会生成单独的 chunk，这些 chunk <strong>默认是异步加载的（类似 <code>async</code>）</strong>，例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-javascript"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> import</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./Foo.vue</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // 生成的文件会异步加载</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>编译后的 HTML 中会看到类似这样的脚本：</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-html"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">script</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> src</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/js/chunk-123456.789abc.js</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;&lt;/</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">&lt;!-- 无 defer/async，但实际是异步加载 --&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Webpack 会通过自身的运行时逻辑管理这些 chunk 的加载，而不是依赖 <code>defer/async</code> 属性。</p><hr><h3 id="_4-如何强制改为-async" tabindex="-1"><a class="header-anchor" href="#_4-如何强制改为-async"><span><strong>4. 如何强制改为 <code>async</code>？</strong></span></a></h3><p>如果需要改为 <code>async</code>，可以在 <code>vue.config.js</code> 中配置：</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-javascript"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">module</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">exports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  chainWebpack</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">plugin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">html</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">).</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tap</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">((</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">      args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">].</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">scriptLoading</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">async</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // 改为 async</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">      return</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    });</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  },</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但需注意：<strong>可能导致依赖加载顺序问题</strong>，需确保代码不依赖同步执行的脚本顺序。</p><hr><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span><strong>总结</strong></span></a></h3><table><thead><tr><th>场景</th><th>加载方式</th><th>原因</th></tr></thead><tbody><tr><td>主入口文件（如 <code>app.js</code>）</td><td><code>defer</code></td><td>保证依赖顺序，不阻塞渲染，兼容 Vue 运行时需求。</td></tr><tr><td>动态导入的 chunk</td><td>异步（类似 <code>async</code>）</td><td>按需加载，由 Webpack 运行时管理，不阻塞初始渲染。</td></tr></tbody></table><p>Vue CLI 的这种默认设计是为了在性能、兼容性和开发体验之间取得平衡。大多数情况下，无需修改默认行为。</p>`,27)])])}const d=i(t,[["render",h]]),p=JSON.parse('{"path":"/blog/mgkcxcmx/","title":"Webpack 编译后的 JavaScript 文件的加载行为 | 技术博客","lang":"zh-CN","frontmatter":{"title":"Webpack 编译后的 JavaScript 文件的加载行为","createTime":"2025/07/18 19:41:44","permalink":"/blog/mgkcxcmx/","tags":["Vue"]},"readingTime":{"minutes":2.06,"words":619},"git":{"createdTime":1752843727000,"updatedTime":1764524144000,"contributors":[{"name":"Kangkang Shang","username":"","email":"535634238@qq.com","commits":2,"avatar":"https://gravatar.com/avatar/899a2a8091fc73ff6879f8a45f98a5a42ca8b9665bca19ce8af3a144e416ed11?d=retro"},{"name":"kangkang shang","username":"","email":"535634238@qq.com","commits":1,"avatar":"https://gravatar.com/avatar/899a2a8091fc73ff6879f8a45f98a5a42ca8b9665bca19ce8af3a144e416ed11?d=retro"}],"changelog":[{"hash":"37a5215b25a66c978fe447e5ce9d1d1acc9adaad","time":1764524144000,"email":"535634238@qq.com","author":"kangkang shang","message":"docs: 更新文档结构和内容"},{"hash":"eefc06dcde22511918e678b96c53eafda9214df7","time":1752851306000,"email":"535634238@qq.com","author":"Kangkang Shang","message":"1"},{"hash":"fea1899ecf98a6a02bb164332b069742456ebf7a","time":1752843727000,"email":"535634238@qq.com","author":"Kangkang Shang","message":"1"}]},"filePathRelative":"blog/Vue/Webpack 编译后的 JavaScript 文件的加载行为.md","headers":[],"categoryList":[{"id":"2d8ec5","sort":10009,"name":"Vue"}],"bulletin":false}');export{d as comp,p as data};
